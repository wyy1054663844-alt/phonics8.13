<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>美式元音播放器（3 组完整功能版）</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  :root{
    --bg1:#0f172a; --bg2:#0b1020;
    --panel:#111827; --muted:#a3aed0; --text:#e8ecf3;
    --blue:#2f80ed; --blueHover:#1c65c8; --accent:#60a5fa;
    --hlIpa:#3ddc97; --hlWord:#fff3bf; --chip:#334155;
    --row:#0b1220; --border:rgba(148,163,184,.18);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    font-family:'Noto Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,"PingFang SC","Microsoft YaHei",sans-serif;
    background: radial-gradient(900px 600px at 10% -10%, #1f2937 0%, transparent 60%),
                linear-gradient(180deg, var(--bg1), var(--bg2));
    padding:14px;
  }
  header{max-width:980px;margin:0 auto 10px}
  h1{font-size:22px;margin:0 0 8px}
  .sub{font-size:12px;color:var(--muted)}
  .toolbar{
    position:sticky;top:8px;z-index:5;backdrop-filter: blur(8px);
    max-width:980px;margin:12px auto;padding:10px;border-radius:14px;
    background:rgba(17,24,39,.7);border:1px solid var(--border);
    display:grid;gap:8px;grid-template-columns:1fr;align-items:center
  }
  @media(min-width:720px){.toolbar{grid-template-columns: 1fr 1fr 1fr}}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  label{font-size:12px;color:var(--muted)}
  select,input[type="range"]{appearance:none;background:#0b1220;color:var(--text);
    border:1px solid var(--border);border-radius:10px;padding:8px 10px}
  .btn{background:var(--blue);color:#fff;border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn:hover{background:var(--blueHover)}
  .btn.secondary{background:#334155}
  .grid{max-width:980px;margin:12px auto;display:grid;grid-template-columns:1fr;gap:14px}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:12px}
  .ipa-line{display:flex;gap:8px;align-items:center;margin-bottom:8px}
  .ipa-btn{font-size:26px;font-weight:800;background:#0b1220;border:1px solid var(--border);
    padding:8px 12px;border-radius:12px;cursor:pointer}
  .ipa-btn.playing{outline:2px solid var(--hlIpa)}
  .tip{font-size:12px;color:var(--muted)}
  .groups{display:flex;gap:6px;flex-wrap:wrap;margin:8px 0}
  .chip{background:var(--chip);color:#dbeafe;border-radius:999px;padding:4px 8px;font-size:12px}
  .list{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:8px}
  .item{display:grid;grid-template-columns:auto 1fr auto;gap:6px;align-items:center;
    background:var(--row);border:1px solid rgba(148,163,184,.12);padding:8px;border-radius:12px}
  .item.active{background:var(--hlWord);color:#222;border-color:#f59e0b}
  .w{font-weight:700}
  .ipa{font-size:12px;color:var(--muted)}
  .zh{font-size:12px;color:#ffd166}
  .play{background:var(--blue);color:#fff;border:none;border-radius:10px;padding:6px 10px;display:flex;gap:6px;align-items:center;cursor:pointer}
  .play:hover{background:var(--blueHover)}
  .play svg{width:16px;height:16px}
  .sep{height:1px;background:linear-gradient(90deg,transparent,#334155,transparent);margin:8px 0}
  .foot{max-width:980px;margin:10px auto;color:var(--muted);font-size:12px;text-align:center}
</style>
</head>
<body>
  <header>
    <h1>美式元音播放器（3 组：/ə/、/ɚ/、/ɝː/）</h1>
    <div class="sub">点击音标：<b>中文要点</b> → 播放 GitHub 原音；点击单词右侧蓝色按钮：<b>英文 → 1 秒 → 中文 → 1 秒 → 英文</b>。支持自动播放、高亮、语速/音量调节、英文/中文音色选择，移动端优化。</div>
  </header>

  <div class="toolbar">
    <div class="row">
      <button class="btn" id="btnAuto">自动播放全部</button>
      <button class="btn secondary" id="btnStop">停止</button>
    </div>
    <div class="row">
      <label>语速 <input id="rate" type="range" min="0.6" max="1.6" step="0.05" value="1"/></label>
      <label>音量 <input id="vol" type="range" min="0.2" max="1" step="0.05" value="1"/></label>
    </div>
    <div class="row">
      <label>英文音色 <select id="voiceEN"></select></label>
      <label>中文音色 <select id="voiceZH"></select></label>
    </div>
  </div>

  <div class="grid" id="grid"></div>

  <div class="foot">音标音频引用：你的 GitHub 仓库 <code>phonics8.13</code> 根目录，文件名规则：<code>ː → _long</code>，例如 <code>ɝː → ɝ_long.mp3</code>。</div>

<script>
// ========= 基础配置 =========
const BASE = 'https://wyy1054663844-alt.github.io/phonics8.13/';
function ipaToFile(ipa){
  const key = ipa;
  const name = encodeURIComponent(key.replace('ː','_long')) + '.mp3';
  return BASE + name;
}
const synth = window.speechSynthesis;
const wait = ms => new Promise(r=>setTimeout(r,ms));

let VOICES_EN=null, VOICES_ZH=null;
function loadVoices(){
  const voices = synth.getVoices();
  VOICES_EN = voices.filter(v=>/en/i.test(v.lang));
  VOICES_ZH = voices.filter(v=>/zh|cmn/i.test(v.lang));
  const enSel = document.getElementById('voiceEN');
  const zhSel = document.getElementById('voiceZH');
  enSel.innerHTML = VOICES_EN.map((v,i)=>`<option value="${i}">${v.name} (${v.lang})</option>`).join('');
  zhSel.innerHTML = VOICES_ZH.map((v,i)=>`<option value="${i}">${v.name} (${v.lang})</option>`).join('');
  // 默认选择常见音色
  const dEN = VOICES_EN.findIndex(v=>/en-US/i.test(v.lang)); if(dEN>=0) enSel.value = dEN;
  const dZH = VOICES_ZH.findIndex(v=>/zh-CN/i.test(v.lang)); if(dZH>=0) zhSel.value = dZH;
}
if(synth.onvoiceschanged !== undefined){ synth.onvoiceschanged = loadVoices; }
window.addEventListener('load', loadVoices);

function getSelected(){
  const rate = parseFloat(document.getElementById('rate').value);
  const vol  = parseFloat(document.getElementById('vol').value);
  const vEN = VOICES_EN?.[document.getElementById('voiceEN').value] || null;
  const vZH = VOICES_ZH?.[document.getElementById('voiceZH').value] || null;
  return {vEN,vZH,rate,vol};
}

function speak(text, voice, rate=1, volume=1){
  return new Promise(res=>{
    const u = new SpeechSynthesisUtterance(text);
    if(voice) u.voice = voice;
    u.rate = rate; u.volume = volume;
    u.onend = ()=>res();
    synth.speak(u);
  });
}

function playAudio(src){
  return new Promise((res,rej)=>{
    const a = new Audio(src);
    a.onended = ()=>res();
    a.onerror = ()=>res(); // 容错
    a.play();
  });
}

// ========= 数据（严格按你的三组与子拼写分组） =========
const DATA = [
  {
    ipa:'ə', tip:'轻读央元音（schwa）。短元音、轻读，口型放松、舌位居中，多见于非重读音节。',
    groups:[
      {label:'a', items:[
        ['about','/əˈbaʊt/','关于']
      ]},
      {label:'e', items:[
        ['open','/ˈoʊ.pən/','打开'],
        ['problem','/ˈprɑː.bləm/','问题'],
        ['synthesis','/ˈsɪn.θə.sɪs/','合成']
      ]},
      {label:'i', items:[
        ['animal','/ˈæn.ɪ.məl/','动物'],
        ['president','/ˈprez.ɪ.dənt/','总统'],
        ['pupil','/ˈpjuː.pəl/','学生']
      ]},
      {label:'o', items:[
        ['bacon','/ˈbeɪ.kən/','培根'],
        ['lesson','/ˈles.ən/','课程'],
        ['pilot','/ˈpaɪ.lət/','飞行员']
      ]},
      {label:'u', items:[
        ['circus','/ˈsɝː.kəs/','马戏团'],
        ['medium','/ˈmiː.di.əm/','媒介；中等'],
        ['support','/səˈpɔːrt/','支持']
      ]},
      {label:'ou', items:[
        ['courageous','/kəˈreɪ.dʒəs/','勇敢的'],
        ['famous','/ˈfeɪ.məs/','著名的'],
        ['humorous','/ˈhjuː.mə.rəs/','幽默的']
      ]},
      {label:'（更多 a 开头）', items:[
        ['banana','/bəˈnæn.ə/','香蕉'],
        ['sofa','/ˈsoʊ.fə/','沙发']
      ]}
    ]
  },
  {
    ipa:'ɚ', tip:'卷舌弱读元音（r-colored schwa）。短元音、轻读，类似“儿化”，常见词尾 -er。',
    groups:[
      {label:'er', items:[
        ['better','/ˈbet̬.ɚ/','更好'],
        ['butter','/ˈbʌt̬.ɚ/','黄油'],
        ['teacher','/ˈtiː.tʃɚ/','老师']
      ]},
      {label:'or', items:[
        ['actor','/ˈæk.tɚ/','演员'],
        ['doctor','/ˈdɑːk.tɚ/','医生'],
        ['editor','/ˈed.ɪ.t̬ɚ/','编辑']
      ]},
      {label:'ar', items:[
        ['beggar','/ˈbeɡ.ɚ/','乞丐'],
        ['burglar','/ˈbɝː.ɡlɚ/','窃贼'],
        ['collar','/ˈkɑː.lɚ/','衣领']
      ]},
      {label:'ure', items:[
        ['culture','/ˈkʌl.tʃɚ/','文化'],
        ['figure','/ˈfɪɡ.jɚ/','人物；数字'],
        ['pressure','/ˈpreʃ.ɚ/','压力']
      ]}
    ]
  },
  {
    ipa:'ɝː', tip:'卷舌重读元音。长元音、重读，舌尖上卷贴近上腭，时值更长。',
    groups:[
      {label:'er', items:[
        ['her','/hɝː/','她（的）'],
        ['term','/tɝːm/','学期；术语'],
        ['clerk','/klɝːk/','职员']
      ]},
      {label:'ear', items:[
        ['earn','/ɝːn/','赚得'],
        ['earth','/ɝːθ/','地球'],
        ['heard','/hɝːd/','听见（过）']
      ]},
      {label:'ir', items:[
        ['bird','/bɝːd/','鸟'],
        ['first','/ˈfɝːst/','第一'],
        ['stir','/stɝː/','搅拌']
      ]},
      {label:'ur', items:[
        ['burn','/bɝːn/','燃烧'],
        ['nurse','/nɝːs/','护士'],
        ['turn','/tɝːn/','转动']
      ]},
      {label:'or', items:[
        ['word','/wɝːd/','单词'],
        ['world','/wɝːld/','世界'],
        ['worse','/wɝːs/','更糟']
      ]}
    ]
  }
];

// ========= 渲染 =========
const grid = document.getElementById('grid');
function render(){
  grid.innerHTML='';
  DATA.forEach(group=>{
    const card = document.createElement('div');
    card.className='card';
    card.dataset.ipa = group.ipa;

    const head = document.createElement('div');
    head.className='ipa-line';

    const ipaBtn = document.createElement('button');
    ipaBtn.className='ipa-btn';
    ipaBtn.textContent = group.ipa;
    ipaBtn.onclick = ()=> playIPA(group.ipa, ipaBtn, group.tip);

    const tip = document.createElement('div');
    tip.className='tip';
    tip.textContent = group.tip;

    head.append(ipaBtn, tip);
    card.appendChild(head);

    // 子分组列表
    const chips = document.createElement('div'); chips.className='groups';
    group.groups.forEach(g=>{
      const c = document.createElement('span'); c.className='chip'; c.textContent = g.label;
      chips.appendChild(c);
    });
    card.appendChild(chips);
    card.appendChild(document.createElement('div')).className='sep';

    const list = document.createElement('div'); list.className='list';
    group.groups.forEach(g=>{
      g.items.forEach(([w, wIpa, zh])=>{
        const row = document.createElement('div');
        row.className='item'; row.dataset.ipa = group.ipa; row.dataset.word = w;

        const t1 = document.createElement('div'); t1.className='w'; t1.textContent = w;
        const t2 = document.createElement('div'); t2.className='ipa'; t2.textContent = wIpa;
        const t3 = document.createElement('div'); t3.className='zh'; t3.textContent = zh;

        const btn = document.createElement('button'); btn.className='play';
        btn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg><span>播放</span>';
        btn.onclick = ()=> playWordRow(row, w, zh);

        row.append(t1,t2,t3,btn);
        list.appendChild(row);
      });
    });
    card.appendChild(list);

    grid.appendChild(card);
  });
}
render();

// ========= 播放控制 =========
function getSel(){ return getSelected(); }

async function playIPA(ipa, btn, tip){
  stopAll();
  const {vZH, rate, vol} = getSel();
  btn.classList.add('playing');
  try{
    if(tip) await speak(tip, vZH, rate, vol);
    await playAudio(ipaToFile(ipa));
  }finally{
    btn.classList.remove('playing');
  }
}

async function playWordRow(row, word, zh){
  stopAll();
  const {vEN, vZH, rate, vol} = getSel();
  row.classList.add('active');
  try{
    await speak(word, vEN, rate, vol);
    await wait(1000);
    await speak(zh, vZH, rate, vol);
    await wait(1000);
    await speak(word, vEN, rate, vol);
  }finally{
    row.classList.remove('active');
  }
}

// 自动播放：按组 → 子分组 → 单词
let abort=false;
function stopAll(){ abort = true; synth.cancel(); }
document.getElementById('btnStop').onclick = stopAll;

document.getElementById('btnAuto').onclick = async ()=>{
  stopAll(); abort=false;
  const {vEN, vZH, rate, vol} = getSel();
  const cards = [...document.querySelectorAll('.card')];
  for(const grp of DATA){
    if(abort) break;
    const card = cards.find(c=>c.dataset.ipa===grp.ipa);
    const ipaBtn = card.querySelector('.ipa-btn');
    ipaBtn.classList.add('playing');
    if(grp.tip) await speak(grp.tip, vZH, rate, vol);
    await playAudio(ipaToFile(grp.ipa));
    ipaBtn.classList.remove('playing');

    const rows = [...card.querySelectorAll('.item')];
    let idx=0;
    for(const g of grp.groups){
      for(const [w, wIpa, zh] of g.items){
        if(abort) break;
        const row = rows[idx++];
        row.classList.add('active');
        await speak(w, vEN, rate, vol);
        await wait(1000);
        await speak(zh, vZH, rate, vol);
        await wait(1000);
        await speak(w, vEN, rate, vol);
        row.classList.remove('active');
      }
    }
  }
};
</script>
</body>
</html>
