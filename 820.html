<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ç¾å¼å…ƒéŸ³æ’­æ”¾å™¨ï¼ˆÊŒ / É‘Ë / É‘Ër + å½•éŸ³å›æ”¾ï¼‰</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#111827; --panel:#0f172a; --card:#121826; --muted:#9aa4b2; --text:#e5e7eb;
    --blue:#2f80ed; --blue2:#1c65c8; --hlIpa:#3ddc97; --hlWord:#fff3bf; --hlBorder:#f59e0b;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; padding:14px; font-family:'Noto Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,"PingFang SC","Microsoft YaHei",sans-serif;
    color:var(--text); background:linear-gradient(180deg,#0d1320,#0b1220 40%,#0a0f1a);
  }
  h1{font-size:22px; margin:6px 0 10px; text-align:center}
  .toolbar{
    position:sticky; top:0; z-index:9; padding:10px; margin:0 auto 12px; max-width:980px;
    background:rgba(15,23,42,.9); border:1px solid rgba(148,163,184,.15); border-radius:14px;
    display:grid; gap:10px; grid-template-columns:1fr; }
  @media (min-width:760px){ .toolbar{grid-template-columns:1fr 1fr} }
  .row{display:flex; flex-wrap:wrap; align-items:center; gap:10px}
  label{font-size:12px; color:var(--muted)}
  select, input[type=range]{
    border:1px solid rgba(148,163,184,.25); background:#0b1220; color:var(--text); padding:8px 10px; border-radius:10px;
  }
  .btn{background:var(--blue); color:#fff; border:none; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer}
  .btn:hover{background:var(--blue2)}
  .btn:active{transform:scale(.98)}
  .tip{max-width:980px; margin:0 auto 10px; font-size:12px; color:var(--muted); text-align:center}

  .vowel{background:var(--card); padding:14px; border-radius:14px; margin:10px auto; max-width:980px; border:2px solid transparent}
  .vowel.active{border-color:var(--hlBorder)}
  .ipaLine{display:flex; align-items:center; gap:10px; margin-bottom:8px}
  .ipaBtn{font-size:26px; font-weight:700; color:var(--hlIpa); cursor:pointer}
  .ipaTip{font-size:12px; color:#cfe6ff}

  .section{margin-top:8px; border-top:1px dashed rgba(148,163,184,.25); padding-top:8px}
  .secTitle{font-size:13px; color:#a8ffef; margin-bottom:6px}

  .examples{display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:8px}
  .word-item{
    display:grid; grid-template-columns:auto 1fr auto auto auto; gap:6px; align-items:center;
    background:rgba(255,255,255,.06); border-radius:12px; padding:8px
  }
  .word-item.active{background: var(--hlWord); color:#222; box-shadow:0 0 0 2px rgba(245,158,11,.25) inset}
  .word-text{font-size:16px; font-weight:700}
  .word-ipa{font-size:12px; color:var(--muted)}
  .word-zh{font-size:12px; color:#ffd166}
  .play-btn, .rec-btn, .replay-btn{
    background:var(--blue); color:#fff; border:none; border-radius:8px; padding:6px 10px; font-size:12px; display:flex; align-items:center; gap:6px; cursor:pointer;
  }
  .play-btn:hover, .rec-btn:hover, .replay-btn:hover{background:var(--blue2)}
  .play-icon{font-weight:700}

  .foot{max-width:980px; margin:12px auto; color:var(--muted); font-size:12px; text-align:center}
</style>
</head>
<body>
  <h1>ç¾å¼å…ƒéŸ³æ’­æ”¾å™¨ï¼ˆÊŒ / É‘Ë / É‘Ërï¼‰</h1>

  <div class="toolbar">
    <div class="row">
      <label>è‹±æ–‡éŸ³è‰²ï¼š</label><select id="enVoice" style="min-width:180px"></select>
      <label>ä¸­æ–‡éŸ³è‰²ï¼š</label><select id="zhVoice" style="min-width:180px"></select>
    </div>
    <div class="row">
      <label>è¯­é€Ÿï¼š</label><input id="rate" type="range" min="0.6" max="1.6" step="0.05" value="1">
      <label>éŸ³é‡ï¼š</label><input id="volume" type="range" min="0" max="1" step="0.05" value="1">
      <button class="btn" id="autoPlay">è‡ªåŠ¨æ’­æ”¾å…¨éƒ¨</button>
      <button class="btn" id="stop">åœæ­¢</button>
    </div>
  </div>

  <p class="tip">ç‚¹å‡»<strong>éŸ³æ ‡</strong>ï¼šä¸­æ–‡è¦ç‚¹ â†’ æ’­æ”¾ GitHub åŸéŸ³ï¼›ç‚¹å‡»<strong>ä¾‹è¯å³ä¾§è“è‰²æŒ‰é’®</strong>ï¼šè‹±æ–‡ â†’ <b>1 ç§’</b> â†’ ä¸­æ–‡ â†’ <b>1 ç§’</b> â†’ è‹±æ–‡ã€‚è‡ªåŠ¨æ’­æ”¾æŒ‰ä½ ç»™çš„é¡ºåºä¾æ¬¡æ’­æ”¾ï¼Œæ’­æ”¾ä¸­é«˜äº®å½“å‰éŸ³æ ‡ä¸å•è¯ã€‚æ¯ä¸ªå•è¯éƒ½æ”¯æŒ<strong>ğŸ™ï¸å½•éŸ³/ğŸ”å›æ”¾</strong>ï¼Œä¾¿äºè‡ªæµ‹å‘éŸ³ã€‚</p>

  <div id="root"></div>

  <div class="foot">éŸ³æ ‡éŸ³é¢‘æ¥è‡ªä½ çš„ GitHubï¼š<code>wyy1054663844-alt/phonics8.13</code>ï¼ˆè§„åˆ™ï¼š<code>Ë â†’ _long</code>ï¼Œä¾‹ï¼š<code>É‘Ë â†’ É‘_long.mp3</code>ï¼‰ã€‚</div>

<script>
/* ===================== åŸºç¡€é…ç½®ï¼ˆå…¼å®¹ç‰ˆï¼‰ ===================== */
var BASE = "https://wyy1054663844-alt.github.io/phonics8.13/";
function ipaToFile(ipa){
  var name = ipa.replace("Ë","_long");
  return BASE + encodeURIComponent(name) + ".mp3";
}
function wait(ms){ return new Promise(function(res){ setTimeout(res, ms); }); }

/* ===================== å‘éŸ³è¦ç‚¹ï¼ˆä¸­æ–‡ï¼‰ ===================== */
var IPA_TIP = {
  "ÊŒ":"çŸ­å…ƒéŸ³ï¼Œå‘éŸ³çŸ­ä¿ƒæœ‰åŠ›ï¼ŒèˆŒä½ä½å¹³é åï¼Œå”‡å½¢è‡ªç„¶æ”¾æ¾ã€‚",
  "É‘Ë":"ç¾å¼é•¿å…ƒéŸ³ï¼Œå‘éŸ³é•¿è€Œé¥±æ»¡ï¼ŒèˆŒä½é åï¼Œå˜´å·´å¼ å¤§ï¼Œä¸è‹±å¼å‘éŸ³æœ‰æ‰€åŒºåˆ«ã€‚",
  "É‘Ër":"å·èˆŒé•¿å…ƒéŸ³ï¼Œé‡è¯»ï¼Œå‘éŸ³æ—¶èˆŒå°–ä¸Šå·ï¼ŒéŸ³é•¿ç¨å»¶é•¿ã€‚",
  // åŸæœ‰çš„éŸ³æ ‡ä¹Ÿä¿ç•™äº†ï¼Œé˜²æ­¢æ··æ·†
  "É™":"è½»è¯»å…ƒéŸ³ï¼ˆschwaï¼‰ï¼ŒçŸ­è€Œè½»ï¼Œå£å‹æ”¾æ¾ã€èˆŒä½å±…ä¸­ï¼Œå¤šå‡ºç°åœ¨éé‡è¯»éŸ³èŠ‚ã€‚",
  "Éš":"å·èˆŒçš„å¼±è¯»å…ƒéŸ³ï¼ˆå„¿åŒ–ï¼‰ï¼ŒçŸ­è€Œè½»ï¼Œå¤šè§è¯å°¾ -erã€‚",
  "ÉË":"å·èˆŒé•¿å…ƒéŸ³ï¼Œé‡è¯»ï¼ŒéŸ³é•¿ç¨å»¶é•¿ï¼ŒèˆŒå°–ä¸Šå·æ¥è¿‘ä¸Šè…­ã€‚"
};

/* ===================== æ•°æ®ï¼ˆä¸¥æ ¼æŒ‰ä½ çš„åˆ†ç»„ä¸é¡ºåºï¼‰ ===================== */
/* ç»“æ„ï¼šgroups -> {ipa, sections:[{title, items:[{w, ipa, zh}]}]} */
var GROUPS = [
  { ipa:"ÊŒ", sections:[
      { title:"u", items:[
        {w:"sun",     ipa:"/sÊŒn/",     zh:"å¤ªé˜³"},
        {w:"cup",     ipa:"/kÊŒp/",     zh:"æ¯å­"},
        {w:"but",     ipa:"/bÊŒt/",     zh:"ä½†æ˜¯"}
      ]},
      { title:"o", items:[
        {w:"son",     ipa:"/sÊŒn/",     zh:"å„¿å­"},
        {w:"comfort", ipa:"/ËˆkÊŒm.fÉšt/", zh:"èˆ’é€‚"},
        {w:"money",   ipa:"/ËˆmÊŒn.i/",   zh:"é‡‘é’±"}
      ]},
      { title:"ou", items:[
        {w:"young",   ipa:"/jÊŒÅ‹/",     zh:"å¹´è½»çš„"},
        {w:"double",  ipa:"/ËˆdÊŒb.É™l/",  zh:"åŒå€"},
        {w:"country", ipa:"/ËˆkÊŒn.tri/", zh:"å›½å®¶"}
      ]},
      { title:"oo", items:[
        {w:"blood",   ipa:"/blÊŒd/",    zh:"è¡€æ¶²"},
        {w:"flood",   ipa:"/flÊŒd/",    zh:"æ´ªæ°´"}
      ]}
  ]},
  { ipa:"É‘Ë", sections:[
      { title:"a", items:[
        {w:"father", ipa:"/ËˆfÉ‘Ë.Ã°Éš/",  zh:"çˆ¶äº²"},
        {w:"watch",  ipa:"/wÉ‘ËtÊƒ/",    zh:"æ‰‹è¡¨"},
        {w:"wasp",   ipa:"/wÉ‘Ësp/",    zh:"é»„èœ‚"}
      ]},
      { title:"al", items:[
        {w:"almond", ipa:"/ËˆÉ‘Ël.mÉ™nd/", zh:"æä»"},
        {w:"balm",   ipa:"/bÉ‘Ëm/",     zh:"é¦™æ²¹"},
        {w:"palm",   ipa:"/pÉ‘Ëm/",     zh:"æ‰‹æŒ"}
      ]},
      { title:"au", items:[
        {w:"because", ipa:"/bÉªËˆkÉ‘Ëz/",  zh:"å› ä¸º"},
        {w:"clause",  ipa:"/klÉ‘Ëz/",    zh:"ä»å¥"},
        {w:"paunch",  ipa:"/pÉ‘ËntÊƒ/",   zh:"å¤§è‚šè…©"}
      ]},
      { title:"aw", items:[
        {w:"drawn",  ipa:"/drÉ‘Ën/",    zh:"ç”»ï¼ˆè¿‡å»å¼ï¼‰"},
        {w:"awning", ipa:"/ËˆÉ‘Ë.nÉªÅ‹/",   zh:"é®é˜³ç¯·"},
        {w:"law",    ipa:"/lÉ‘Ë/",      zh:"æ³•å¾‹"}
      ]},
      { title:"o", items:[
        {w:"hot",    ipa:"/hÉ‘Ët/",     zh:"çƒ­çš„"},
        {w:"dog",    ipa:"/dÉ‘ËÉ¡/",     zh:"ç‹—"},
        {w:"log",    ipa:"/lÉ‘ËÉ¡/",     zh:"åŸæœ¨"}
      ]},
      { title:"ough", items:[
        {w:"bought", ipa:"/bÉ‘Ët/",    zh:"ä¹°ï¼ˆè¿‡å»å¼ï¼‰"},
        {w:"thought",ipa:"/Î¸É‘Ët/",    zh:"æƒ³ï¼ˆè¿‡å»å¼ï¼‰"},
        {w:"fought", ipa:"/fÉ‘Ët/",    zh:"æ‰“ï¼ˆè¿‡å»å¼ï¼‰"}
      ]}
  ]},
  { ipa:"É‘Ër", sections:[
      { title:"ar", items:[
        {w:"car",   ipa:"/kÉ‘Ër/",  zh:"æ±½è½¦"},
        {w:"far",   ipa:"/fÉ‘Ër/",  zh:"è¿œçš„"},
        {w:"start", ipa:"/stÉ‘Ërt/", zh:"å¼€å§‹"}
      ]}
  ]}
];

/* ===================== è¯­éŸ³å¼•æ“ï¼ˆå…¼å®¹ï¼‰ ===================== */
var synth = window.speechSynthesis;
var currentAudio = null;
var stopFlag = false;
var enVoices = []; var zhVoices = [];

function pickVoice(lang, selectId){
  try{
    var list = synth.getVoices() || [];
    var i, arr = [];
    for(i=0;i<list.length;i++){
      var v = list[i];
      if(!v || !v.lang) continue;
      if(lang === 'en'){ if(/en[-_]/i.test(v.lang)) arr.push(v); }
      else{ if(/^zh/i.test(v.lang) || /cmn/i.test(v.lang)) arr.push(v); }
    }
    if(lang === 'en') enVoices = arr; else zhVoices = arr;
    var sel = document.getElementById(selectId);
    var html = "";
    for(i=0;i<arr.length;i++){ html += '<option value="'+i+'">'+ arr[i].name +' ('+ arr[i].lang +')</option>'; }
    sel.innerHTML = html;
    if(lang==='en'){
      var idxUS = arr.findIndex(function(v){return /en-US/i.test(v.lang);});
      if(idxUS>=0) sel.value = String(idxUS);
    }else{
      var idxCN = arr.findIndex(function(v){return /zh-CN/i.test(v.lang);});
      if(idxCN>=0) sel.value = String(idxCN);
    }
  }catch(e){}
}
function loadVoices(){ pickVoice('en','enVoice'); pickVoice('zh','zhVoice'); }
if (synth && typeof synth.onvoiceschanged !== 'undefined'){ synth.onvoiceschanged = loadVoices; }
setTimeout(loadVoices, 200);

function currentRate(){ return Math.max(0.1, parseFloat(document.getElementById('rate').value||'1')); }
function currentVol(){  var v = parseFloat(document.getElementById('volume').value||'1'); return (v>=0&&v<=1)?v:1; }

function getVoice(lang){
  var sel = document.getElementById(lang==='en'?'enVoice':'zhVoice');
  var idx = parseInt(sel.value||'-1',10);
  var arr = (lang==='en')? enVoices : zhVoices;
  return (arr && arr[idx]) ? arr[idx] : null;
}

function speak(text, lang){
  return new Promise(function(resolve){
    try{
      var u = new SpeechSynthesisUtterance(text);
      u.lang = (lang==='en')? 'en-US':'zh-CN';
      u.rate = currentRate();
      u.volume = currentVol();
      var v = getVoice(lang);
      if(v) u.voice = v;
      u.onend = resolve;
      synth.speak(u);
    }catch(e){ resolve(); }
  });
}

function playAudio(url){
  return new Promise(function(resolve){
    try{ if(currentAudio){ currentAudio.pause(); currentAudio=null; } }catch(e){}
    var a = new Audio(url);
    currentAudio = a;
    a.onended = function(){ currentAudio=null; resolve(); };
    a.onerror = function(){ currentAudio=null; resolve(); };
    a.play().catch(function(){ resolve(); });
  });
}
// --- iOS WebAudio unlockï¼ˆä¿æŒåŸé€»è¾‘ï¼‰ ---
var unlocked = false;
function unlockAudioOnce(){
  return new Promise(function(resolve){
    if(unlocked){ resolve(); return; }
    var silent = new SpeechSynthesisUtterance(" ");
    silent.volume = 0; silent.rate = 1; silent.lang = 'en-US';
    silent.onend = function(){
      var b = new Audio('data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAA');
      b.play().catch(function(){}).finally(function(){ unlocked = true; resolve(); });
    };
    try{ synth.speak(silent); }catch(e){ unlocked = true; resolve(); }
  });
}

/* ===================== é«˜äº®å·¥å…· ===================== */
function clearHighlights(){
  document.querySelectorAll('.vowel').forEach(function(el){ el.classList.remove('active'); });
  document.querySelectorAll('.word-item').forEach(function(el){ el.classList.remove('active'); });
}
function highlightIpa(ipa){
  clearHighlights();
  var el = document.querySelector('.vowel[data-ipa="'+ ipa.replace(/"/g,'\\"') +'"]');
  if(el) el.classList.add('active');
}
function highlightWord(ipa, word){
  document.querySelectorAll('.word-item').forEach(function(el){ el.classList.remove('active'); });
  var sel = '.word-item[data-ipa="'+ ipa.replace(/"/g,'\\"') +'"][data-word="'+ word.replace(/"/g,'\\"') +'"]';
  var el = document.querySelector(sel);
  if(el) el.classList.add('active');
}

/* ===================== æ’­æ”¾åºåˆ— ===================== */
function stopAll(){
  stopFlag = true;
  try{ synth.cancel(); }catch(e){}
  try{ if(currentAudio){ currentAudio.pause(); currentAudio=null; } }catch(e){}
  clearHighlights();
}
function playIpaWithTip(ipa){
  return new Promise(async function(resolve){
    stopFlag = false;
    highlightIpa(ipa);
    await speak(IPA_TIP[ipa]||"å‘éŸ³æç¤º", 'zh');
    if(stopFlag){ resolve(); return; }
    await playAudio(ipaToFile(ipa));
    resolve();
  });
}
function playWordSeq(ipa, word, zh){
  return new Promise(async function(resolve){
    stopFlag = false;
    highlightWord(ipa, word);
    await speak(word, 'en');
    if(stopFlag){ resolve(); return; }
    await wait(1000);
    await speak(zh, 'zh');
    if(stopFlag){ resolve(); return; }
    await wait(1000);
    await speak(word, 'en');
    resolve();
  });
}

/* ===================== å½•éŸ³å™¨ï¼ˆiOS å‹å¥½ï¼šWebAudio + WAVï¼‰ ===================== */
var recorder = (function(){
  var ctx, stream, source, processor, recording = false, buffers = [], sampleRate = 44100, currentKey = null;
  var recordings = new Map(); // wordKey -> Blob(audio/wav)

  async function ensureContext(){
    if(!ctx){
      var AC = window.AudioContext || window.webkitAudioContext;
      ctx = AC ? new AC() : null;
    }
    if(ctx && ctx.state === 'suspended'){ try{ await ctx.resume(); }catch(e){} }
    return ctx;
  }
  async function ensureMic(){
    if(stream) return stream;
    stream = await navigator.mediaDevices.getUserMedia({audio:true});
    return stream;
  }
  function createNode(){
    destroyNode();
    source = ctx.createMediaStreamSource(stream);
    // 4096 å¸§ï¼Œå•å£°é“
    processor = ctx.createScriptProcessor(4096, 1, 1);
    processor.onaudioprocess = function(e){
      if(!recording) return;
      var ch = e.inputBuffer.getChannelData(0);
      // å¤åˆ¶åˆ°æ–° Float32Arrayï¼Œé¿å…åç»­å¤ç”¨
      buffers.push(new Float32Array(ch));
    };
    source.connect(processor);
    processor.connect(ctx.destination);
  }
  function destroyNode(){
    if(processor){ try{ processor.disconnect(); }catch(e){} processor = null; }
    if(source){ try{ source.disconnect(); }catch(e){} source = null; }
  }
  function encodeWAV(float32Data, sRate){
    // åˆå¹¶
    var length = 0;
    for(var i=0;i<float32Data.length;i++){ length += float32Data[i].length; }
    var data = new Float32Array(length);
    var offset = 0;
    for(var j=0;j<float32Data.length;j++){ data.set(float32Data[j], offset); offset += float32Data[j].length; }
    // è½¬ 16-bit PCM
    var bytesPerSample = 2;
    var blockAlign = 1 * bytesPerSample;
    var buffer = new ArrayBuffer(44 + data.length * bytesPerSample);
    var view = new DataView(buffer);

    function writeString(v, off, str){ for(var i=0;i<str.length;i++) v.setUint8(off+i, str.charCodeAt(i)); }
    function floatTo16BitPCM(output, offset, input){
      for (var i=0; i<input.length; i++, offset+=2) {
        var s = Math.max(-1, Math.min(1, input[i]));
        output.setInt16(offset, s<0 ? s*0x8000 : s*0x7FFF, true);
      }
    }
    // WAV å¤´
    writeString(view, 0, 'RIFF');
    view.setUint32(4, 36 + data.length * bytesPerSample, true);
    writeString(view, 8, 'WAVE');
    writeString(view, 12, 'fmt ');
    view.setUint32(16, 16, true); // PCM
    view.setUint16(20, 1, true);  // Linear PCM
    view.setUint16(22, 1, true);  // mono
    view.setUint32(24, sRate, true);
    view.setUint32(28, sRate * blockAlign, true);
    view.setUint16(32, blockAlign, true);
    view.setUint16(34, 8 * bytesPerSample, true);
    writeString(view, 36, 'data');
    view.setUint32(40, data.length * bytesPerSample, true);
    // PCM æ•°æ®
    floatTo16BitPCM(view, 44, data);

    return new Blob([view], {type:'audio/wav'});
  }

  return {
    async start(wordKey){
      // ç»ˆæ­¢æ‰€æœ‰ TTS/éŸ³é¢‘ï¼Œé¿å…ä¸²éŸ³
      stopAll();
      var c = await ensureContext();
      if(!c) throw new Error('å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ AudioContext');
      await unlockAudioOnce();
      await ensureMic();
      createNode();
      buffers = [];
      currentKey = wordKey;
      recording = true;
    },
    async stop(){
      recording = false;
      var blob = encodeWAV(buffers, ctx.sampleRate || sampleRate);
      recordings.set(currentKey, blob);
      destroyNode(); // é‡Šæ”¾èŠ‚ç‚¹ï¼ˆä¿ç•™æµä»¥ä¾¿ä¸‹æ¬¡æ›´å¿«å¯åŠ¨ï¼‰
      return blob;
    },
    has(wordKey){ return recordings.has(wordKey); },
    play(wordKey){
      var blob = recordings.get(wordKey);
      if(!blob) throw new Error('è¯¥å•è¯è¿˜æ²¡æœ‰å½•éŸ³');
      var url = URL.createObjectURL(blob);
      var a = new Audio(url);
      a.play();
    }
  };
})();

/* ===================== é¡µé¢æ¸²æŸ“ ===================== */
function render(){
  var root = document.getElementById('root');
  root.innerHTML = '';
  GROUPS.forEach(function(g){
    var card = document.createElement('div');
    card.className = 'vowel';
    card.setAttribute('data-ipa', g.ipa);

    var line = document.createElement('div');
    line.className = 'ipaLine';
    var ipaBtn = document.createElement('span');
    ipaBtn.className = 'ipaBtn';
    ipaBtn.textContent = g.ipa;
    ipaBtn.title = 'ç‚¹å‡»ï¼šä¸­æ–‡è¦ç‚¹ â†’ æ’­æ”¾è¯¥éŸ³æ ‡åŸéŸ³';
    ipaBtn.addEventListener('click', function(){ stopAll(); playIpaWithTip(g.ipa); });

    var tip = document.createElement('span');
    tip.className = 'ipaTip';
    tip.textContent = IPA_TIP[g.ipa] || 'å‘éŸ³æç¤º';

    line.appendChild(ipaBtn); line.appendChild(tip);
    card.appendChild(line);

    g.sections.forEach(function(sec){
      var secBox = document.createElement('div'); secBox.className='section';
      var title = document.createElement('div'); title.className='secTitle'; title.textContent = sec.title;
      secBox.appendChild(title);

      var list = document.createElement('div'); list.className='examples';
      sec.items.forEach(function(it){
        var row = document.createElement('div'); row.className='word-item';
        row.setAttribute('data-ipa', g.ipa); row.setAttribute('data-word', it.w);

        var t1 = document.createElement('div'); t1.className='word-text'; t1.textContent = it.w;
        var t2 = document.createElement('div'); t2.className='word-ipa'; t2.textContent = it.ipa;
        var t3 = document.createElement('div'); t3.className='word-zh';  t3.textContent  = it.zh;

        // æ’­æ”¾ï¼ˆè‹±â†’1sâ†’ä¸­â†’1sâ†’è‹±ï¼‰
        var playBtn = document.createElement('button'); playBtn.className='play-btn';
        playBtn.innerHTML = '<span class="play-icon">â–¶</span>æ’­æ”¾';
        playBtn.addEventListener('click', function(){ stopAll(); playWordSeq(g.ipa, it.w, it.zh); });

        // å½•éŸ³
        var recBtn = document.createElement('button'); recBtn.className='rec-btn'; recBtn.textContent = 'ğŸ™ï¸å½•éŸ³';
        var recState = { recording:false };
        recBtn.addEventListener('click', async function(){
          try{
            if(!recState.recording){
              await recorder.start(it.w);
              recState.recording = true;
              recBtn.textContent = 'â¹åœæ­¢';
            }else{
              await recorder.stop();
              recState.recording = false;
              recBtn.textContent = 'ğŸ™ï¸å½•éŸ³';
            }
          }catch(err){
            recState.recording = false;
            recBtn.textContent = 'ğŸ™ï¸å½•éŸ³';
            alert('å½•éŸ³å¤±è´¥ï¼š' + (err && err.message ? err.message : err));
          }
        });

        // å›æ”¾
        var replayBtn = document.createElement('button'); replayBtn.className='replay-btn'; replayBtn.textContent = 'ğŸ”å›æ”¾';
        replayBtn.addEventListener('click', function(){
          try{
            if(!recorder.has(it.w)) { alert('è¯¥å•è¯è¿˜æ²¡æœ‰å½•éŸ³'); return; }
            recorder.play(it.w);
          }catch(err){
            alert('å›æ”¾å¤±è´¥ï¼š' + (err && err.message ? err.message : err));
          }
        });

        row.appendChild(t1); row.appendChild(t2); row.appendChild(t3);
        row.appendChild(playBtn); row.appendChild(recBtn); row.appendChild(replayBtn);
        list.appendChild(row);
      });

      secBox.appendChild(list);
      card.appendChild(secBox);
    });

    root.appendChild(card);
  });
}
render();

/* ===================== è‡ªåŠ¨æ’­æ”¾å…¨éƒ¨ ===================== */
document.getElementById('autoPlay').addEventListener('click', async function(){
  stopAll(); stopFlag=false;
  await unlockAudioOnce(); // iOS è§£é”
  for(var i=0;i<GROUPS.length;i++){
    if(stopFlag) break;
    var g = GROUPS[i];
    await playIpaWithTip(g.ipa);
    if(stopFlag) break;
    for(var j=0;j<g.sections.length;j++){
      if(stopFlag) break;
      var sec = g.sections[j];
      for(var k=0;k<sec.items.length;k++){
        if(stopFlag) break;
        var it = sec.items[k];
        await wait(250);
        await playWordSeq(g.ipa, it.w, it.zh);
      }
    }
  }
  clearHighlights();
});

document.getElementById('stop').addEventListener('click', stopAll);
</script>
</body>
</html>